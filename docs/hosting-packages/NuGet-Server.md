---
title: Использование NuGet.Server для размещения веб-каналов NuGet
description: Описывается создание и размещение веб-канала пакетов NuGet на любом сервере со службами IIS с помощью NuGet.Server для предоставления доступа к пакетам по протоколам HTTP и OData.
author: kraigb
ms.author: kraigb
manager: douge
ms.date: 03/13/2018
ms.topic: conceptual
ms.openlocfilehash: 55501eedf6c5fdf054a602536ee8c03e7048d5d5
ms.sourcegitcommit: 3eab9c4dd41ea7ccd2c28bb5ab16f6fbbec13708
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2018
---
# <a name="nugetserver"></a>NuGet.Server

NuGet.Server — это предоставляемый организацией .NET Foundation пакет, который создает приложение ASP.NET для размещения веб-канала пакетов на любом сервере со службами IIS. Попросту говоря, NuGet.Server создает на сервере папку, доступную по протоколу HTTP(S) (и, в частности, OData). Простота настройки делает это решение оптимальным для несложных сценариев.

1. Создайте пустое веб-приложение ASP.NET в Visual Studio и добавьте в него пакет NuGet.Server.
1. Настройте папку `Packages` в приложении и добавьте пакеты.
1. Разверните приложение на подходящем сервере.

В следующих разделах подробно рассматривается выполнение этого процесса с помощью C#.

Если у вас есть дополнительные вопросы о NuGet.Server, сообщите об этом на [https://github.com/nuget/NuGetGallery/issues](https://github.com/nuget/NuGetGallery/issues).

## <a name="create-and-deploy-an-aspnet-web-application-with-nugetserver"></a>Создание и развертывание веб-приложения ASP.NET с пакетом NuGet.Server

1. В Visual Studio последовательно выберите **Файл > Создать > Проект**, выполните поиск по запросу "ASP.NET", и выберите шаблон **Веб-приложение ASP.NET (.NET Framework)** для C# и задайте для параметра **Framework** значение ".NET Framework 4.6".

    ![Задание целевой платформы для нового проекта](media/Hosting_01-NuGet.Server-Set4.6.png)

1. Присвойте приложению подходящее имя, *отличное* от NuGet.Server, нажмите кнопку "ОК", а затем в следующем диалоговом окне выберите **пустой** шаблон и нажмите кнопку **ОК**.

1. Щелкните проект правой кнопкой мыши и выберите **Управление пакетами NuGet**.

1. В пользовательском интерфейсе диспетчера пакетов откройте вкладку **Обзор**, а затем найдите и установите последнюю версию пакета NuGet.Server, если целевой платформой является .NET Framework 4.6. (Ее также можно установить из консоли диспетчера пакетов с помощью команды `Install-Package NuGet.Server`.) Примите условия лицензионного соглашения при отображении соответствующего запроса.

    ![Установка пакета NuGet.Server](media/Hosting_02-NuGet.Server-Package.png)

1. В результате установки NuGet.Server пустое веб-приложение преобразуется в источник пакетов. При этом устанавливаются разные пакеты, в приложении создается папка `Packages`, а в файл `web.config` добавляются дополнительные параметры (подробные сведения см. в комментариях в этом файле).

    > [!Important]
    > Тщательно проверьте `web.config` после того, как пакет NuGet.Server внесет все изменения в этот файл. NuGet.Server может не перезаписывать имеющиеся элементы, а создавать их дубликаты. Позднее при попытке запуска проекта эти дубликаты приведут к ошибке "Внутренняя ошибка сервера". Например, если ваш файл `web.config` содержит `<compilation debug="true" targetFramework="4.5.2" />` до установки NuGet.Server, пакет не перезаписывает его, а вставляет второй экземпляр `<compilation debug="true" targetFramework="4.6" />`. В этом случае удалите элемент с более старой версией платформы.

1. Чтобы сделать пакеты доступными через веб-канал при публикации приложения на сервере, добавьте файлы каждого `.nupkg` в папку `Packages` в Visual Studio, а затем присвойте свойству **Действие сборки** значение **Содержимое**, а свойству **Копировать в выходной каталог** — значение **Всегда копировать**.

    ![Копирование пакетов в папку Packages в проекте](media/Hosting_03-NuGet.Server-Package-Folder.png)

1. Запустите сайт локально в Visual Studio (используя команду **Отладка > Запуск без отладки** или сочетание клавиш CTRL+F5). Домашняя страница содержит URL-адреса веб-канала пакетов, как показано ниже. Если возникают ошибки, тщательно изучите `web.config` на наличие повторяющихся элементов, как указано в шаге 5.

    ![Домашняя страница по умолчанию для приложения с пакетом NuGet.Server](media/Hosting_04-NuGet.Server-FeedHomePage.png)

1. Щелкните ссылку **here** (здесь) в выделенной выше области, чтобы увидеть веб-канал пакетов OData.

1. При первом запуске приложения пакет NuGet.Server изменяет структуру папки `Packages` так, чтобы она содержала вложенную папку для каждого пакета. Такая структура соответствует [структуре локального хранилища](http://blog.nuget.org/20151118/nuget-3.3.html#folder-based-repository-commands), представленной в NuGet 3.3, что позволяет повысить производительность. При добавлении дополнительных пакетов следуйте этой структуре.

1. Протестировав развертывание в локальной среде, можно развернуть приложение на любом внутреннем или внешней сайте.

1. При развертывании на сайте `http://<domain>` URL-адрес источника пакетов будет иметь вид `http://<domain>/nuget`.

## <a name="configuring-the-packages-folder"></a>Настройка папки Packages

В `NuGet.Server` 1.5 или более поздней версии можно более детально настроить папку с пакетами с помощью значения `appSetting/packagesPath` в файле `web.config`.

```xml
<appSettings>
    <!-- Set the value here to specify your custom packages folder. -->
    <add key="packagesPath" value="C:\MyPackages" />
</appSettings>
```

`packagesPath` может быть абсолютным или виртуальным путем.

Если параметр `packagesPath` опущен или имеет пустое значение, используется папка пакетов по умолчанию `~/Packages`.

## <a name="adding-packages-to-the-feed-externally"></a>Добавление пакетов в веб-канал извне

После запуска сайта NuGet.Server можно добавить пакеты с помощью [nuget push](../tools/cli-ref-push.md) при условии, что в файле `web.config` задано значение ключа API.

После установки пакета NuGet.Server файл `web.config` содержит пустое значение `appSetting/apiKey`.

```xml
<appSettings>
    <add key="apiKey" value="" />
</appSettings>
```

Если параметр `apiKey` опущен или имеет пустое значение, отправка пакетов в веб-канал отключена.

Чтобы включить эту возможность, присвойте параметру `apiKey` значение (в идеале надежный пароль) и добавьте ключ `appSettings/requireApiKey` со значением `true`.

```xml
<appSettings>
        <!-- Sets whether an API Key is required to push/delete packages -->
    <add key="requireApiKey" value="true" />

    <!-- Set a shared password (for all users) to push/delete packages -->
    <add key="apiKey" value="" />
</appSettings>
```

Если сервер уже защищен или ключ API не требуется по иным причинам (например, при использовании частного сервера в локальной сети рабочей группы), ключу `requireApiKey` можно присвоить значение `false`. После этого все пользователи, имеющие доступ к серверу, смогут отправлять пакеты.

## <a name="removing-packages-from-the-feed"></a>Удаление пакетов из веб-канала

При использовании NuGet.Server команда [nuget delete](../tools/cli-ref-delete.md) удаляет пакет из репозитория при условии, что вы указали ключ API вместе с комментарием.

Если вы хотите изменить поведение, чтобы вместо этого удалить пакет из списка (оставив его доступным для восстановления), измените значение ключа `enableDelisting` в `web.config` на true.

## <a name="nugetserver-support"></a>Поддержка NuGet.Server

Для получения дополнительной помощи по использованию NuGet.Server сообщите о проблеме на сайте [https://github.com/nuget/NuGetGallery/issues](https://github.com/nuget/NuGetGallery/issues).