---
title: Ключи API с ограниченной областью действия
description: Управление ключами API, которые используются при отправке пакетов
author: mikejo5000
ms.author: mikejo
ms.date: 06/04/2019
ms.topic: conceptual
ms.openlocfilehash: 12d12d5294a474c4d3e4f5d3cad468bb515d21d5
ms.sourcegitcommit: 2b50c450cca521681a384aa466ab666679a40213
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2020
ms.locfileid: "67426949"
---
# <a name="scoped-api-keys"></a><span data-ttu-id="64f92-103">Ключи API с ограниченной областью действия</span><span class="sxs-lookup"><span data-stu-id="64f92-103">Scoped API keys</span></span>

<span data-ttu-id="64f92-104">Чтобы обеспечить эффективную защиту среды NuGet при распространении пакетов, вы можете управлять ключами API, добавляя области действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-104">To make NuGet a more secure environment for package distribution, you can take control of the API keys by adding scopes.</span></span>

<span data-ttu-id="64f92-105">Ограничивая область действия ключей API, вы оптимизируете управление API.</span><span class="sxs-lookup"><span data-stu-id="64f92-105">The ability to provide scope to your API keys give you better control on your APIs.</span></span> <span data-ttu-id="64f92-106">Вы можете:</span><span class="sxs-lookup"><span data-stu-id="64f92-106">You can:</span></span>

- <span data-ttu-id="64f92-107">Создавать несколько ключей API с ограниченной областью действия, которые могут использоваться для различных пакетов с разными сроками действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-107">Create multiple scoped API keys that can be used for different packages with varying expiration timeframes.</span></span>
- <span data-ttu-id="64f92-108">Безопасно получать ключи API.</span><span class="sxs-lookup"><span data-stu-id="64f92-108">Obtain API keys securely.</span></span>
- <span data-ttu-id="64f92-109">Редактировать существующие ключи API, изменяя параметры применимости для пакета.</span><span class="sxs-lookup"><span data-stu-id="64f92-109">Edit existing API keys to change package applicability.</span></span>
- <span data-ttu-id="64f92-110">Обновлять или удалять существующие ключи API, не мешая операциям, использующим другие ключи.</span><span class="sxs-lookup"><span data-stu-id="64f92-110">Refresh or delete existing API keys without hampering operations using other keys.</span></span>

## <a name="why-do-we-support-scoped-api-keys"></a><span data-ttu-id="64f92-111">Для чего нужна поддержка ключей API с ограниченной областью действия?</span><span class="sxs-lookup"><span data-stu-id="64f92-111">Why do we support scoped API keys?</span></span>

<span data-ttu-id="64f92-112">Поддержка ключей API с ограниченной областью действия позволяет более детально настраивать разрешения.</span><span class="sxs-lookup"><span data-stu-id="64f92-112">We support scopes for API keys to allow you to have more fine-grained permissions.</span></span> <span data-ttu-id="64f92-113">Ранее в NuGet использовался один ключ API для учетной записи, что имело ряд недостатков.</span><span class="sxs-lookup"><span data-stu-id="64f92-113">Previously, NuGet offered a single API key for an account, and that approach had several drawbacks:</span></span>

- <span data-ttu-id="64f92-114">**Один ключ API для управления всеми пакетами**.</span><span class="sxs-lookup"><span data-stu-id="64f92-114">**One API key to control all packages**.</span></span> <span data-ttu-id="64f92-115">Поскольку для управления всеми пакетами использовался один ключ API, было сложно обеспечить безопасность при совместном использовании ключа несколькими разработчиками, которые работают с разными пакетами в рамках одной учетной записи издателя.</span><span class="sxs-lookup"><span data-stu-id="64f92-115">With a single API key that is used to manage all packages, it is difficult to securely share the key when multiple developers are involved with different packages, and when they share a publisher account.</span></span>
- <span data-ttu-id="64f92-116">**Невозможность назначать частичные разрешения**.</span><span class="sxs-lookup"><span data-stu-id="64f92-116">**All permissions or none**.</span></span> <span data-ttu-id="64f92-117">Любой пользователь, имеющий доступ к ключу API, получал все разрешения в отношении пакетов, в том числе для их публикации, отправки и исключения из списка.</span><span class="sxs-lookup"><span data-stu-id="64f92-117">Anyone with access to the API key has all permissions (publish, push and un-list) on the packages.</span></span> <span data-ttu-id="64f92-118">В среде с несколькими командами такое поведение зачастую нежелательно.</span><span class="sxs-lookup"><span data-stu-id="64f92-118">This is often not desirable in environment with multiple teams.</span></span>
- <span data-ttu-id="64f92-119">**Единственная точка сбоя**.</span><span class="sxs-lookup"><span data-stu-id="64f92-119">**Single point of failure**.</span></span> <span data-ttu-id="64f92-120">Использование одного ключа API также приводит к возникновению единой точки отказа.</span><span class="sxs-lookup"><span data-stu-id="64f92-120">A single API key also means a single point of failure.</span></span> <span data-ttu-id="64f92-121">Если такой ключ становится известен посторонним лицам, под угрозу могут попасть все пакеты, связанные с учетной записью.</span><span class="sxs-lookup"><span data-stu-id="64f92-121">If the key is compromised, all packages associated with the account could potentially be compromised.</span></span> <span data-ttu-id="64f92-122">В таком случае единственным способом предотвратить утечку и избежать нарушений в рабочем процессе непрерывной интеграции и развертывания становится обновление ключа API.</span><span class="sxs-lookup"><span data-stu-id="64f92-122">Refreshing the API key is the only way to plug the leak and avoid an interruption to your CI/CD workflow.</span></span> <span data-ttu-id="64f92-123">Кроме того, возможны случаи, в которых требуется отозвать права доступа к ключу API у одного пользователя (например, если он или она покидает организацию).</span><span class="sxs-lookup"><span data-stu-id="64f92-123">In addition, there may be cases when you want to revoke access to the API key for an individual (for example, when an employee leaves the organization).</span></span> <span data-ttu-id="64f92-124">На данный момент удобного выхода из такой ситуации не существует.</span><span class="sxs-lookup"><span data-stu-id="64f92-124">There isn’t a clean way to handle this today.</span></span>

<span data-ttu-id="64f92-125">Используя ключи API с ограниченной областью действия, мы пытаемся решить эти проблемы и обеспечить непрерывность существующих рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="64f92-125">With scoped API keys, we try to address these problems while making sure that none of the existing workflows break.</span></span>

## <a name="acquire-an-api-key"></a><span data-ttu-id="64f92-126">Получение ключа API</span><span class="sxs-lookup"><span data-stu-id="64f92-126">Acquire an API key</span></span>

[!INCLUDE [publish-api-key](../quickstart/includes/publish-api-key.md)]

## <a name="create-scoped-api-keys"></a><span data-ttu-id="64f92-127">Создание ключей API с ограниченной областью действия</span><span class="sxs-lookup"><span data-stu-id="64f92-127">Create scoped API keys</span></span>

<span data-ttu-id="64f92-128">Вы можете создавать несколько ключей API в соответствии с потребностями.</span><span class="sxs-lookup"><span data-stu-id="64f92-128">You can create multiple API keys based on your requirements.</span></span> <span data-ttu-id="64f92-129">Ключи API могут применяться к одному или нескольким пакетами, иметь разные области действия с уникальными привилегиями, а также разные сроки действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-129">An API key can apply to one or more packages, have varying scopes that grant specific privileges, and have an expiration date associated with it.</span></span>

<span data-ttu-id="64f92-130">В следующем примере показан ключ API с именем `Contoso service CI`, который можно использовать для отправки пакетов для `Contoso.Service` на протяжении 365 дней.</span><span class="sxs-lookup"><span data-stu-id="64f92-130">In the following example, you have an API key named `Contoso service CI` that can be used to push packages for specific `Contoso.Service` packages, and is valid for 365 days.</span></span> <span data-ttu-id="64f92-131">Это типичный сценарий, в котором различные команды работают с разными пакетами в рамках одной организации. В этом случае членам команды предоставляется ключ, дающий привилегии для работы только с назначенными им пакетами.</span><span class="sxs-lookup"><span data-stu-id="64f92-131">This is a typical scenario where different teams within the same organization work on different packages, and the members of the team are provided the key that grants them privileges only for the package they are working on.</span></span> <span data-ttu-id="64f92-132">Ограничение срока действия позволяет предотвратить устаревание или утрату ключей.</span><span class="sxs-lookup"><span data-stu-id="64f92-132">The expiration serves as a mechanism to prevent stale or forgotten keys.</span></span>

![Создание ключей API](media/scoped-api-keys-create-new.png)

## <a name="use-glob-patterns"></a><span data-ttu-id="64f92-134">Использование стандартных масок</span><span class="sxs-lookup"><span data-stu-id="64f92-134">Use glob patterns</span></span>

<span data-ttu-id="64f92-135">Если вы управляете большим списком пакетов, для одновременного выбора нескольких пакетов можно использовать стандартные маски.</span><span class="sxs-lookup"><span data-stu-id="64f92-135">If you are working on multiple packages and have a large list of packages to manage, you can choose to use globbing patterns to select multiple packages together.</span></span> <span data-ttu-id="64f92-136">Например, если вы хотите задать области действия ключа для всех пакетов, идентификатор которых начинается с `Fabrikam.Service`, необходимо указать `fabrikam.service.*` в текстовом поле **Стандартная маска**.</span><span class="sxs-lookup"><span data-stu-id="64f92-136">For example, if you wish to grant specific scopes to a key for all packages whose ID starts with `Fabrikam.Service`, you could do this by specifying `fabrikam.service.*` in the **Glob pattern** text box.</span></span>

![Создание ключей API](media/scoped-api-keys-glob-pattern.png)

<span data-ttu-id="64f92-138">Если разрешения для ключа API определяются на основе стандартной маски, они будут применяться к новым пакетам, которые соответствуют этой маске.</span><span class="sxs-lookup"><span data-stu-id="64f92-138">Using glob patterns to determine API key permissions also applies to new packages matching the glob pattern.</span></span> <span data-ttu-id="64f92-139">Например, для отправки пакета с названием `Fabrikam.Service.Framework` вы можете использовать ранее созданный ключ, поскольку этот пакет соответствует стандартной маске `fabrikam.service.*`.</span><span class="sxs-lookup"><span data-stu-id="64f92-139">For example, if you try to push a new package named `Fabrikam.Service.Framework`, you can do that with the key created previously, since the package matches the glob pattern `fabrikam.service.*`.</span></span>

## <a name="obtain-api-keys-securely"></a><span data-ttu-id="64f92-140">Безопасное получение ключей API</span><span class="sxs-lookup"><span data-stu-id="64f92-140">Obtain API keys securely</span></span>

<span data-ttu-id="64f92-141">В целях безопасности создаваемый ключ никогда не отображается на экране и может использоваться только посредством кнопки **Копировать**.</span><span class="sxs-lookup"><span data-stu-id="64f92-141">For security, a newly created key is never shown on the screen and is only available using the **Copy** button.</span></span> <span data-ttu-id="64f92-142">Ключ также будет недоступен в случае обновления страницы.</span><span class="sxs-lookup"><span data-stu-id="64f92-142">Similarly, the key is not accessible after the page is refreshed.</span></span>

![Создание ключей API](media/scoped-api-keys-obtain-keys.png)

## <a name="edit-existing-api-keys"></a><span data-ttu-id="64f92-144">Изменение существующих ключей API</span><span class="sxs-lookup"><span data-stu-id="64f92-144">Edit existing API keys</span></span>

<span data-ttu-id="64f92-145">Вы также можете обновить разрешения и области действия для ключа, не изменяя сам ключ.</span><span class="sxs-lookup"><span data-stu-id="64f92-145">You may also want to update the key permissions and scopes without changing the key itself.</span></span> <span data-ttu-id="64f92-146">Если у вас есть ключ с заданными областями действия для одного пакета, вы можете применить эти области к одному или нескольким другим пакетам.</span><span class="sxs-lookup"><span data-stu-id="64f92-146">If you have a key with specific scope(s) for a single package, you can choose to apply the same scope(s) on one or many other packages.</span></span>

![Создание ключей API](media/scoped-api-keys-edit.png)

## <a name="refresh-or-delete-existing-api-keys"></a><span data-ttu-id="64f92-148">Обновление или удаление существующих ключей API</span><span class="sxs-lookup"><span data-stu-id="64f92-148">Refresh or delete existing API keys</span></span>

<span data-ttu-id="64f92-149">Владелец учетной записи может обновить ключ. При этом выдается новый ключ с теми же разрешениями (в отношении пакетов), областями и сроками действия, а старый ключ выводится из обращения.</span><span class="sxs-lookup"><span data-stu-id="64f92-149">The account owner can choose to refresh the key, in which case the permission (on packages), scope, and expiry remain the same, but a new key is issued making the old key unusable.</span></span> <span data-ttu-id="64f92-150">Это позволяет предотвратить устаревание ключей API и защититься от риска их утечки.</span><span class="sxs-lookup"><span data-stu-id="64f92-150">This is helpful in managing stale keys or where there is any potential for an API key leakage.</span></span>

![Создание ключей API](media/scoped-api-keys-refresh.png)

<span data-ttu-id="64f92-152">Также вы можете удалять неиспользуемые ключи.</span><span class="sxs-lookup"><span data-stu-id="64f92-152">You may also choose to delete these keys if they are not needed anymore.</span></span> <span data-ttu-id="64f92-153">В этом случае ключ выводится из обращения.</span><span class="sxs-lookup"><span data-stu-id="64f92-153">Deleting a key removes the key and makes it unusable.</span></span>

## <a name="faqs"></a><span data-ttu-id="64f92-154">Часто задаваемые вопросы</span><span class="sxs-lookup"><span data-stu-id="64f92-154">FAQs</span></span>

### <a name="what-happens-to-my-old-legacy-api-key"></a><span data-ttu-id="64f92-155">Что происходит с устаревшим ключом API?</span><span class="sxs-lookup"><span data-stu-id="64f92-155">What happens to my old (legacy) API key?</span></span>

<span data-ttu-id="64f92-156">Устаревший ключ API продолжает действовать до тех пор, пока вам это необходимо.</span><span class="sxs-lookup"><span data-stu-id="64f92-156">Your old API key (legacy) continues to work and can work as long as you want it to work.</span></span> <span data-ttu-id="64f92-157">Тем не менее, такие ключи выводятся из обращения, если они не использовались для отправки пакетов более 365 дней.</span><span class="sxs-lookup"><span data-stu-id="64f92-157">However, these keys will be retired if they have not been used for more than 365 days to push a package.</span></span> <span data-ttu-id="64f92-158">Дополнительные сведения см. в записи блога, посвященной [изменению существующих ключей API](https://blog.nuget.org/20160825/Changes-to-Expiring-API-Keys.html).</span><span class="sxs-lookup"><span data-stu-id="64f92-158">For more details, see the blog post [Changes to expiring API keys](https://blog.nuget.org/20160825/Changes-to-Expiring-API-Keys.html).</span></span> <span data-ttu-id="64f92-159">Дальнейшее обновление такого ключа невозможно.</span><span class="sxs-lookup"><span data-stu-id="64f92-159">You can no longer refresh this key.</span></span> <span data-ttu-id="64f92-160">При необходимости вам потребуется удалить устаревший ключ и создать вместо него новый ключ с ограниченной областью действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-160">You need to delete the legacy key and create a new scoped key instead.</span></span>

> [!NOTE]
> <span data-ttu-id="64f92-161">Этот ключ будет иметь все разрешения в отношении всех пакетов и неограниченный срок действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-161">This key has all permissions on all the packages and it never expires.</span></span> <span data-ttu-id="64f92-162">В таких случаях рекомендуется удалить этот ключ и создать вместо него новые ключи с ограниченными областями и сроками действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-162">You should consider deleting this key and creating new keys with scoped permissions and definite expiry.</span></span>

### <a name="how-many-api-keys-can-i-create"></a><span data-ttu-id="64f92-163">Сколько ключей API можно создавать?</span><span class="sxs-lookup"><span data-stu-id="64f92-163">How many API keys can I create?</span></span>

<span data-ttu-id="64f92-164">Количество создаваемых ключей API не ограничивается.</span><span class="sxs-lookup"><span data-stu-id="64f92-164">There is no limit on the number of API keys you can create.</span></span> <span data-ttu-id="64f92-165">Тем не менее, чтобы эффективно контролировать устаревшие ключи и параметры их использования, рекомендуется не превышать удобное для управления количество ключей.</span><span class="sxs-lookup"><span data-stu-id="64f92-165">However, we advise you to keep it to a manageable count so that you do not end up having many stale keys with no knowledge of where and who is using them.</span></span>

### <a name="can-i-delete-my-legacy-api-key-or-discontinue-using-now"></a><span data-ttu-id="64f92-166">Можно ли удалить устаревший ключ API или перестать использовать его?</span><span class="sxs-lookup"><span data-stu-id="64f92-166">Can I delete my legacy API key or discontinue using now?</span></span>

<span data-ttu-id="64f92-167">Да.</span><span class="sxs-lookup"><span data-stu-id="64f92-167">Yes.</span></span> <span data-ttu-id="64f92-168">Вы можете и скорее всего должны удалять устаревшие ключи API.</span><span class="sxs-lookup"><span data-stu-id="64f92-168">You can--and you probably should--delete your legacy API key.</span></span>

### <a name="can-i-get-back-my-api-key-that-i-deleted-by-mistake"></a><span data-ttu-id="64f92-169">Можно ли восстановить ошибочно удаленный ключ API?</span><span class="sxs-lookup"><span data-stu-id="64f92-169">Can I get back my API key that I deleted by mistake?</span></span>

<span data-ttu-id="64f92-170">Нет.</span><span class="sxs-lookup"><span data-stu-id="64f92-170">No.</span></span> <span data-ttu-id="64f92-171">После удаления вы можете только создавать новые ключи.</span><span class="sxs-lookup"><span data-stu-id="64f92-171">Once deleted, you can only create new keys.</span></span> <span data-ttu-id="64f92-172">Возможность восстанавливать случайно удаленные ключи не предусматривается.</span><span class="sxs-lookup"><span data-stu-id="64f92-172">There is no recovery possible for accidentally deleted keys.</span></span>

### <a name="does-the-old-api-key-continue-to-work-upon-api-key-refresh"></a><span data-ttu-id="64f92-173">Продолжает ли старый ключ API работать после обновления ключа API?</span><span class="sxs-lookup"><span data-stu-id="64f92-173">Does the old API key continue to work upon API key refresh?</span></span>

<span data-ttu-id="64f92-174">Нет.</span><span class="sxs-lookup"><span data-stu-id="64f92-174">No.</span></span> <span data-ttu-id="64f92-175">После обновления ключа создается новый ключ с теми же разрешениями, областями и сроками действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-175">Once you refresh a key, a new key gets generated that has the same scope, permission, and expiry as the old one.</span></span> <span data-ttu-id="64f92-176">Старый ключ при этом выводится из обращения.</span><span class="sxs-lookup"><span data-stu-id="64f92-176">The old key ceases to exist.</span></span>

### <a name="can-i-give-more-permissions-to-an-existing-api-key"></a><span data-ttu-id="64f92-177">Могу ли я предоставить дополнительные разрешения для существующего ключа API?</span><span class="sxs-lookup"><span data-stu-id="64f92-177">Can I give more permissions to an existing API key?</span></span>

<span data-ttu-id="64f92-178">Вы не можете изменять область действия, однако имеете возможность изменить список пакетов, к которым применяется ключ.</span><span class="sxs-lookup"><span data-stu-id="64f92-178">You cannot modify the scope, but you can edit the package list it is applicable to.</span></span>

### <a name="how-do-i-know-if-any-of-my-keys-expired-or-are-getting-expired"></a><span data-ttu-id="64f92-179">Как узнать, срок действия каких ключей истекает или уже истек?</span><span class="sxs-lookup"><span data-stu-id="64f92-179">How do I know if any of my keys expired or are getting expired?</span></span>

<span data-ttu-id="64f92-180">Если срок действия какого-либо ключа скоро истечет, вы увидите соответствующее предупреждающее сообщение в верхней части страницы.</span><span class="sxs-lookup"><span data-stu-id="64f92-180">If any key expires, we will let you know through a warning message at the top of the page.</span></span> <span data-ttu-id="64f92-181">Кроме того, за десять дней до истечения срока действия ключа мы отправим владельцу учетной записи по электронной почте предупреждение, чтобы вы могли заблаговременно предпринять необходимые действия.</span><span class="sxs-lookup"><span data-stu-id="64f92-181">We also send a warning e-mail to the account holder ten days before the expiration of the key so that you can act on it well in advance.</span></span>