---
title: Ключи API с ограниченной областью действия
description: Управление ключами API, которые используются при отправке пакетов
author: mikejo5000
ms.author: mikejo
ms.date: 06/04/2019
ms.topic: conceptual
ms.openlocfilehash: 12d12d5294a474c4d3e4f5d3cad468bb515d21d5
ms.sourcegitcommit: b6810860b77b2d50aab031040b047c20a333aca3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/28/2019
ms.locfileid: "67426949"
---
# <a name="scoped-api-keys"></a>Ключи API с ограниченной областью действия

Чтобы обеспечить эффективную защиту среды NuGet при распространении пакетов, вы можете управлять ключами API, добавляя области действия.

Ограничивая область действия ключей API, вы оптимизируете управление API. Можно выполнить следующие действия.

- Создавать несколько ключей API с ограниченной областью действия, которые могут использоваться для различных пакетов с разными сроками действия.
- Безопасно получать ключи API.
- Редактировать существующие ключи API, изменяя параметры применимости для пакета.
- Обновлять или удалять существующие ключи API, не мешая операциям, использующим другие ключи.

## <a name="why-do-we-support-scoped-api-keys"></a>Для чего нужна поддержка ключей API с ограниченной областью действия?

Поддержка ключей API с ограниченной областью действия позволяет более детально настраивать разрешения. Ранее в NuGet использовался один ключ API для учетной записи, что имело ряд недостатков.

- **Один ключ API для управления всеми пакетами**. Поскольку для управления всеми пакетами использовался один ключ API, было сложно обеспечить безопасность при совместном использовании ключа несколькими разработчиками, которые работают с разными пакетами в рамках одной учетной записи издателя.
- **Невозможность назначать частичные разрешения**. Любой пользователь, имеющий доступ к ключу API, получал все разрешения в отношении пакетов, в том числе для их публикации, отправки и исключения из списка. В среде с несколькими командами такое поведение зачастую нежелательно.
- **Единая точка отказа**. Использование одного ключа API также приводит к возникновению единой точки отказа. Если такой ключ становится известен посторонним лицам, под угрозу могут попасть все пакеты, связанные с учетной записью. В таком случае единственным способом предотвратить утечку и избежать нарушений в рабочем процессе непрерывной интеграции и развертывания становится обновление ключа API. Кроме того, возможны случаи, в которых требуется отозвать права доступа к ключу API у одного пользователя (например, если он или она покидает организацию). На данный момент удобного выхода из такой ситуации не существует.

Используя ключи API с ограниченной областью действия, мы пытаемся решить эти проблемы и обеспечить непрерывность существующих рабочих процессов.

## <a name="acquire-an-api-key"></a>Получение ключа API

[!INCLUDE [publish-api-key](../quickstart/includes/publish-api-key.md)]

## <a name="create-scoped-api-keys"></a>Создание ключей API с ограниченной областью действия

Вы можете создавать несколько ключей API в соответствии с потребностями. Ключи API могут применяться к одному или нескольким пакетами, иметь разные области действия с уникальными привилегиями, а также разные сроки действия.

В следующем примере показан ключ API с именем `Contoso service CI`, который можно использовать для отправки пакетов для `Contoso.Service` на протяжении 365 дней. Это типичный сценарий, в котором различные команды работают с разными пакетами в рамках одной организации. В этом случае членам команды предоставляется ключ, дающий привилегии для работы только с назначенными им пакетами. Ограничение срока действия позволяет предотвратить устаревание или утрату ключей.

![Создание ключей API](media/scoped-api-keys-create-new.png)

## <a name="use-glob-patterns"></a>Использование стандартных масок

Если вы управляете большим списком пакетов, для одновременного выбора нескольких пакетов можно использовать стандартные маски. Например, если вы хотите задать области действия ключа для всех пакетов, идентификатор которых начинается с `Fabrikam.Service`, необходимо указать `fabrikam.service.*` в текстовом поле **Стандартная маска**.

![Создание ключей API](media/scoped-api-keys-glob-pattern.png)

Если разрешения для ключа API определяются на основе стандартной маски, они будут применяться к новым пакетам, которые соответствуют этой маске. Например, для отправки пакета с названием `Fabrikam.Service.Framework` вы можете использовать ранее созданный ключ, поскольку этот пакет соответствует стандартной маске `fabrikam.service.*`.

## <a name="obtain-api-keys-securely"></a>Безопасное получение ключей API

В целях безопасности создаваемый ключ никогда не отображается на экране и может использоваться только посредством кнопки **Копировать**. Ключ также будет недоступен в случае обновления страницы.

![Создание ключей API](media/scoped-api-keys-obtain-keys.png)

## <a name="edit-existing-api-keys"></a>Изменение существующих ключей API

Вы также можете обновить разрешения и области действия для ключа, не изменяя сам ключ. Если у вас есть ключ с заданными областями действия для одного пакета, вы можете применить эти области к одному или нескольким другим пакетам.

![Создание ключей API](media/scoped-api-keys-edit.png)

## <a name="refresh-or-delete-existing-api-keys"></a>Обновление или удаление существующих ключей API

Владелец учетной записи может обновить ключ. При этом выдается новый ключ с теми же разрешениями (в отношении пакетов), областями и сроками действия, а старый ключ выводится из обращения. Это позволяет предотвратить устаревание ключей API и защититься от риска их утечки.

![Создание ключей API](media/scoped-api-keys-refresh.png)

Также вы можете удалять неиспользуемые ключи. В этом случае ключ выводится из обращения.

## <a name="faqs"></a>Часто задаваемые вопросы

### <a name="what-happens-to-my-old-legacy-api-key"></a>Что происходит с устаревшим ключом API?

Устаревший ключ API продолжает действовать до тех пор, пока вам это необходимо. Тем не менее, такие ключи выводятся из обращения, если они не использовались для отправки пакетов более 365 дней. Дополнительные сведения см. в записи блога, посвященной [изменению существующих ключей API](https://blog.nuget.org/20160825/Changes-to-Expiring-API-Keys.html). Дальнейшее обновление такого ключа невозможно. При необходимости вам потребуется удалить устаревший ключ и создать вместо него новый ключ с ограниченной областью действия.

> [!NOTE]
> Этот ключ будет иметь все разрешения в отношении всех пакетов и неограниченный срок действия. В таких случаях рекомендуется удалить этот ключ и создать вместо него новые ключи с ограниченными областями и сроками действия.

### <a name="how-many-api-keys-can-i-create"></a>Сколько ключей API можно создавать?

Количество создаваемых ключей API не ограничивается. Тем не менее, чтобы эффективно контролировать устаревшие ключи и параметры их использования, рекомендуется не превышать удобное для управления количество ключей.

### <a name="can-i-delete-my-legacy-api-key-or-discontinue-using-now"></a>Можно ли удалить устаревший ключ API или перестать использовать его?

Да. Вы можете и скорее всего должны удалять устаревшие ключи API.

### <a name="can-i-get-back-my-api-key-that-i-deleted-by-mistake"></a>Можно ли восстановить ошибочно удаленный ключ API?

Нет. После удаления вы можете только создавать новые ключи. Возможность восстанавливать случайно удаленные ключи не предусматривается.

### <a name="does-the-old-api-key-continue-to-work-upon-api-key-refresh"></a>Продолжает ли старый ключ API работать после обновления ключа API?

Нет. После обновления ключа создается новый ключ с теми же разрешениями, областями и сроками действия. Старый ключ при этом выводится из обращения.

### <a name="can-i-give-more-permissions-to-an-existing-api-key"></a>Могу ли я предоставить дополнительные разрешения для существующего ключа API?

Вы не можете изменять область действия, однако имеете возможность изменить список пакетов, к которым применяется ключ.

### <a name="how-do-i-know-if-any-of-my-keys-expired-or-are-getting-expired"></a>Как узнать, срок действия каких ключей истекает или уже истек?

Если срок действия какого-либо ключа скоро истечет, вы увидите соответствующее предупреждающее сообщение в верхней части страницы. Кроме того, за десять дней до истечения срока действия ключа мы отправим владельцу учетной записи по электронной почте предупреждение, чтобы вы могли заблаговременно предпринять необходимые действия.