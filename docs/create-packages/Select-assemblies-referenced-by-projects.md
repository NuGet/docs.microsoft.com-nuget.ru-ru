---
title: Выбор сборок, на которые ссылаются проекты
description: Выбор подмножества сборок в пакете, которые будут доступны компилятору, в то время как все сборки будут доступны во время выполнения.
author: zivkan
ms.author: zivkan
ms.date: 05/24/2019
ms.topic: conceptual
ms.openlocfilehash: b32075c3f2c06c15c07d36602bdabdaee8b9405a
ms.sourcegitcommit: 2b50c450cca521681a384aa466ab666679a40213
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2020
ms.locfileid: "67427479"
---
# <a name="select-assemblies-referenced-by-projects"></a>Выбор сборок, на которые ссылаются проекты

Применение явных ссылок на сборки позволяет использовать для технологии IntelliSense и компилятора подмножество сборок, в то время как все сборки будут доступны во время выполнения. `PackageReference` и `packages.config` работают по-разному, в связи с чем авторам пакета может потребоваться обеспечить поддержку обоих типов проекта при создании пакета.

> [!Note]
> Явно задаваемые ссылки на сборки связаны со сборками .NET. Это не способ распространения машинных сборок, для которых управляемые сборки осуществляют платформенные вызовы.

## <a name="packagereference-support"></a>Поддержка `PackageReference`

Если в проекте используется пакет с `PackageReference`, который содержит каталог `ref\<tfm>\`, NuGet будет классифицировать расположенные в нем сборки как ресурсы времени компиляции. Сборки в каталоге `lib\<tfm>\` при этом будут классифицироваться как ресурсы времени выполнения. Сборки в каталоге `ref\<tfm>\` не используются во время выполнения. Это означает, что для любой сборки в каталоге `ref\<tfm>\` должна присутствовать соответствующая сборка в каталоге `lib\<tfm>\` или `runtime\`, иначе во время выполнения скорее всего произойдет ошибка. Поскольку сборки из каталога `ref\<tfm>\` не используются во время выполнения, они могут [содержать только метаданные](https://github.com/dotnet/roslyn/blob/master/docs/features/refout.md) в целях уменьшения размера пакета.

> [!Important]
> Если пакет содержит элемент nuspec `<references>` (используется в `packages.config`, как описывается ниже) и не имеет сборок в каталоге `ref\<tfm>\`, NuGet объявит сборки, перечисленные в элементе nuspec `<references>`, одновременно как сборки времени компиляции и выполнения. Это означает, что когда вызываемые по ссылке сборки будут пробовать загрузить любую другую сборку из каталога `lib\<tfm>\`, произойдет исключение времени выполнения.

> [!Note]
> Если пакет содержит каталог `runtime\`, NuGet может не использовать ресурсы из каталога `lib\`.

## <a name="packagesconfig-support"></a>Поддержка `packages.config`

Проекты, использующие `packages.config` для управления пакетами NuGet, как правило добавляют ссылки на все сборки в каталоге `lib\<tfm>\`. Каталог `ref\` был добавлен для поддержки `PackageReference` и не учитывается при использовании `packages.config`. Чтобы явно указать сборки, на которые ссылки для проектов задаются с использованием `packages.config`, пакет должен использовать элемент [`<references>` в файле nuspec ](../reference/nuspec.md#explicit-assembly-references). Пример:

```xml
<references>
    <group targetFramework="net45">
        <reference file="MyLibrary.dll" />
    </group>
</references>
```

> [!Note]
> Проект `packages.config` использует процесс [ResolveAssemblyReference](https://github.com/Microsoft/msbuild/blob/master/documentation/wiki/ResolveAssemblyReference.md) для копирования сборок в выходной каталог `bin\<configuration>\`. Сборка проекта копируется, после чего система сборки проверяет манифест сборки на наличие вызываемых по ссылке сборок, а затем копирует эти сборки и рекурсивно повторяет эту операцию для всех сборок. Это означает, что если какая-либо сборка в вашем каталоге `lib\<tfm>\` не используются в манифесте какой-либо другой сборки в качестве зависимого компонента (если сборка загружается во время выполнения с использованием `Assembly.Load`, MEF или другой платформы внедрения зависимостей), она может не копироваться в выходной каталог `bin\<configuration>\` вашего проекта, несмотря на присутствие в каталоге `bin\<tfm>\`.

## <a name="example"></a>Пример

Мой пакет будет содержать три сборки (`MyLib.dll`, `MyHelpers.dll` и `MyUtilities.dll`), нацеленные на платформу .NET Framework 4.7.2. `MyUtilities.dll` содержит классы, предназначенные для использования только двумя другими сборками, поэтому мне не требуется использовать эти классы для функции IntelliSense или во время компиляции в проектах, использующих мой пакет. Мой файл `nuspec` должен содержать следующие элементы XML:

```xml
<references>
    <group targetFramework="net472">
        <reference file="MyLib.dll" />
        <reference file="MyHelpers.dll" />
    </group>
</references>
```

в пакете будут присутствовать следующие файлы:

```text
lib\net472\MyLib.dll
lib\net472\MyHelpers.dll
lib\net472\MyUtilities.dll
ref\net472\MyLib.dll
ref\net472\MyHelpers.dll
```
