---
title: Общие сведения об API сервера NuGet
description: Серверный API NuGet — это набор конечных точек HTTP, которые можно использовать для скачивания пакетов, получения метаданных, публикации новых пакетов и т. д.
author: joelverhagen
ms.author: jver
ms.date: 10/26/2017
ms.topic: reference
ms.reviewer: kraigb
ms.openlocfilehash: aacf56a5dc5af9abf6f60d42bc7fd530a128d0d8
ms.sourcegitcommit: b138bc1d49fbf13b63d975c581a53be4283b7ebf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2020
ms.locfileid: "93237813"
---
# <a name="nuget-server-api"></a>API сервера NuGet

API сервера NuGet — это набор конечных точек HTTP, которые можно использовать для скачивания пакетов, получения метаданных, публикации новых пакетов и выполнения большинства других операций, доступных в официальных клиентах NuGet.

Этот API используется клиентом NuGet в Visual Studio, nuget.exe и .NET CLI для выполнения операций NuGet, таких как [`dotnet restore`](/dotnet/core/tools/dotnet-restore?tabs=netcore2x) , поиск в пользовательском интерфейсе Visual Studio и [`nuget.exe push`](../reference/cli-reference/cli-ref-push.md) .

Обратите внимание, что в некоторых случаях nuget.org имеет дополнительные требования, которые не применяются другими источниками пакетов. Эти различия описаны [протоколами NuGet.org](nuget-protocols.md).

Простое перечисление и Загрузка доступных nuget.exe версий см. в [tools.jsв](tools-json.md) конечной точке.

## <a name="service-index"></a>Индекс службы

Точка входа для API — это документ JSON в хорошо известном расположении. Этот документ называется **индексом службы** . Расположение индекса службы для nuget.org — `https://api.nuget.org/v3/index.json` .

Этот документ JSON содержит список *ресурсов* , которые предоставляют различные функциональные возможности и выполняют различные варианты использования.

Клиенты, поддерживающие API, должны принимать один или несколько URL-адресов этого индекса службы как средства подключения к соответствующим источникам пакетов.

Дополнительные сведения об индексе службы см. в [справочнике по API](service-index.md).

## <a name="versioning"></a>Управление версиями

API имеет версию 3 протокола HTTP NuGet. Этот протокол иногда называют "API V3". Эти справочные документы будут ссылаться на эту версию протокола просто как «API».

Версия схемы индекса службы указывается `version` свойством в индексе службы. API требует, чтобы строка версии была основным номером версии `3` . Так как в схему индекса службы вносятся некритические изменения, дополнительный номер версии строки версии увеличится.

Более старые клиенты (например, nuget.exe 2. x) не поддерживают API V3 и поддерживают только старый API v2, который здесь не описан.

Интерфейс API NuGet v3 именуется таким образом, поскольку он является последователем API v2, который был протоколом на основе OData, реализованным в версии 2. x официального клиента NuGet. API V3 впервые поддерживался версией 3,0 официального клиента NuGet и по-прежнему является последней версией основного протокола, поддерживаемой клиентом NuGet, 4,0 и on. 

В API были сделаны некритические изменения протокола, так как он был впервые выпущен.

## <a name="resources-and-schema"></a>Ресурсы и схема

**Индекс службы** описывает различные ресурсы. Текущий набор поддерживаемых ресурсов выглядит следующим образом:

Имя ресурса                                                        | Обязательное значение | Описание
-------------------------------------------------------------------- | -------- | -----------
[Каталог](catalog-resource.md)                                       | Нет       | Полная запись всех событий пакета.
[паккажебасеаддресс](package-base-address-resource.md)               | да      | Получение содержимого пакета (. nupkg).
[паккажедетаилсуритемплате](package-details-template-resource.md)    | Нет       | Создайте URL-адрес для доступа к веб странице сведений о пакете.
[паккажепублиш](package-publish-resource.md)                        | да      | Отправка и удаление пакетов (или вывод их из списка).
[регистратионсбасеурл](registration-base-url-resource.md)            | да      | Получение метаданных пакета.
[репортабусеуритемплате](report-abuse-resource.md)                   | Нет       | Создайте URL-адрес для доступа к веб странице о нарушении отчета.
[репоситорисигнатурес](repository-signatures-resource.md)            | Нет       | Получение сертификатов, используемых для подписи репозитория.
[сеарчаутокомплетесервице](search-autocomplete-service-resource.md) | Нет       | Обнаружение идентификаторов и версий пакетов по подстрокам.
[сеарчкуерисервице](search-query-service-resource.md)               | да      | Фильтрация и поиск пакетов по ключевому слову.
[симболпаккажепублиш](symbol-package-publish-resource.md)           | Нет       | Отправка пакетов символов.

Как правило, все недвоичные данные, возвращаемые ресурсом API, сериализуются с помощью JSON. Схема ответа, возвращаемая каждым ресурсом в индексе службы, определяется отдельно для этого ресурса. Дополнительные сведения о каждом ресурсе см. в разделах, перечисленных выше.

В будущем по мере развития протокола новые свойства могут быть добавлены в ответы JSON. Чтобы клиент не появлялся в будущем, реализация не должна рассчитывать на то, что схема ответа является окончательной и не может включать дополнительные данные. Все свойства, которые не распознает реализация, следует игнорировать.

> [!Note]
> Если источник не реализует `SearchAutocompleteService` никакого поведения автозаполнения, его следует отключить надлежащим образом. Если `ReportAbuseUriTemplate` не реализовано, официальный клиент NuGet возвращается к URL-адресу сообщения о нарушении отчета в NuGet. org (с учетом [NuGet/Home # 4924](https://github.com/NuGet/Home/issues/4924)). Другие клиенты могут отказаться от передачи пользователю URL-адреса сообщения о нарушении.

### <a name="undocumented-resources-on-nugetorg"></a>Недокументированные ресурсы в nuget.org

Индекс службы v3 в nuget.org содержит некоторые ресурсы, которые не описаны выше. Существует несколько причин, по которым не документирование ресурса.

Во первых, мы не будем документировать ресурсы, используемые в качестве деталей реализации nuget.org. `SearchGalleryQueryService` Относится к этой категории. [Нужетгаллери](https://github.com/NuGet/NuGetGallery) использует этот ресурс для делегирования некоторых запросов v2 (OData) в наш индекс поиска вместо использования базы данных. Этот ресурс был представлен для целей масштабируемости и не предназначен для внешнего использования.

Во вторых, мы не будем документировать ресурсы, которые никогда не поставляются в ОКОНЧАТЕЛЬНОй версии официального клиента.
`PackageDisplayMetadataUriTemplate` и `PackageVersionDisplayMetadataUriTemplate` попадают в эту категорию.

В третьих, мы не будем документировать ресурсы, тесно связанные с протоколом v2, который намеренно недокументирован. `LegacyGallery`Ресурс попадает в эту категорию. Этот ресурс позволяет индексу службы v3 указывать на соответствующий URL-адрес источника v2. Этот ресурс поддерживает `nuget.exe list` .

Если ресурс не описан здесь, *настоятельно* рекомендуется не зависеть от них. Мы можем удалить или изменить поведение этих недокументированных ресурсов, что может нарушить вашу реализацию непредвиденным образом.

## <a name="timestamps"></a>Метки времени

Все отметки времени, возвращаемые API-интерфейсом, имеют формат UTC или, в ином случае, указываются с использованием представления [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) . 

## <a name="http-methods"></a>Методы HTTP

Команда   | Использовать
------ | -----------
GET    | Выполняет операцию только для чтения, обычно получая данные.
HEAD   | Извлекает заголовки ответа для соответствующего `GET` запроса.
ОТПРАВКА    | Создает ресурс, который не существует, или, если он существует, обновляет его. Некоторые ресурсы могут не поддерживать обновление.
DELETE | Удаляет ресурс или отменяет его список.

## <a name="http-status-codes"></a>Коды состояния HTTP

Код | Описание
---- | -----
200  | Успешно, и имеется текст ответа.
201  | Успешно, и ресурс был создан.
202  | Успешно, запрос принят, но некоторые операции все еще могут быть неполными и выполняться асинхронно.
204  | Успешно, но текст ответа отсутствует.
301  | Постоянное перенаправление.
302  | Временное перенаправление.
400  | Параметры в URL-адресе или в тексте запроса являются недопустимыми.
401  | Предоставлены недопустимые учетные данные.
403  | Действие не разрешено по указанным учетным данным.
404  | Запрашиваемый ресурс не существует.
409  | Запрос конфликтует с существующим ресурсом.
500  | В службе произошла непредвиденная ошибка.
503  | Служба временно недоступна.

Любой `GET` запрос, выполненный в конечной точке API, может возвращать перенаправление HTTP (301 или 302). Клиенты должны надлежащим образом обработать такие перенаправления, просматривая `Location` заголовок и выполнив последующее `GET` . Документация, касающаяся конкретных конечных точек, не будет явно вызывать, где можно использовать перенаправления.

В случае кода состояния уровня 500 клиент может реализовать разумный механизм повторных попыток. Официальный клиент NuGet повторяет попытку три раза при возникновении любого кода состояния уровня 500 или ошибки TCP/DNS.

## <a name="http-request-headers"></a>Заголовки запросов HTTP

name                     | Описание
------------------------ | -----------
X-NuGet-ApiKey           | Требуется для принудительной отправки и удаления, см. в разделе [ `PackagePublish` ресурс](package-publish-resource.md) .
X-NuGet-Client-Version   | Не **рекомендуется** и заменено на`X-NuGet-Protocol-Version`
X-NuGet-Protocol-версия | Обязательный в некоторых случаях только для nuget.org. см. раздел [протоколы NuGet.org](NuGet-Protocols.md) .
X-NuGet-Session-ID       | *Необязательно* . Клиенты NuGet версии 4.7 и более поздние определяют HTTP-запросы, которые являются частью одного сеанса клиента NuGet.

Объект `X-NuGet-Session-Id` имеет одно значение для всех операций, связанных с одним восстановлением в `PackageReference` . В других сценариях, таких как автозаполнение и `packages.config` восстановление, может существовать несколько разных идентификаторов сеанса из-за того, как код был множителем.

## <a name="authentication"></a>Аутентификация

Проверка подлинности остается в реализации определения источника пакета. Для nuget.org только `PackagePublish` ресурс требует проверки подлинности через специальный заголовок ключа API. Дополнительные сведения см. в разделе [ `PackagePublish` ресурс](package-publish-resource.md) .
