---
title: Миграция из Package. config в форматы PackageReference
description: Сведения о том, как выполнить миграцию проекта из формата управления Package. config в PackageReference, поддерживаемый NuGet 4.0 + и VS2017 и .NET Core 2,0
author: karann-msft
ms.author: karann
ms.date: 05/24/2019
ms.topic: conceptual
ms.openlocfilehash: d1c32f4a926f1f688db3ea6a9ca2eed1a21b2dec
ms.sourcegitcommit: f9e39ff9ca19ba4a26e52b8a5e01e18eb0de5387
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68433294"
---
# <a name="migrate-from-packagesconfig-to-packagereference"></a>Миграция из Packages. config в PackageReference

Visual Studio 2017 версии 15,7 и более поздних версий поддерживает миграцию проекта из формата управления [Packages. config](./packages-config.md) в формат [PackageReference](../consume-packages/Package-References-in-Project-Files.md) .

## <a name="benefits-of-using-packagereference"></a>Преимущества использования PackageReference

* **Управляйте всеми зависимостями проектов в одном месте**: Как и в случае ссылок на проекты и ссылки на сборки, ссылки на пакет NuGet `PackageReference` (с помощью узла) управляются непосредственно в файлах проекта вместо использования отдельного файла Packages. config.
* **Неперегруженное представление зависимостей верхнего уровня**: В отличие от Packages. config, PackageReference перечисляет только те пакеты NuGet, которые были установлены непосредственно в проекте. В результате пользовательский интерфейс диспетчера пакетов NuGet и файл проекта не будут перегружены с зависимостями нижнего уровня.
* **Повышение производительности**. При использовании PackageReference пакеты хранятся в папке *Global-Packages* (как описано в разделе [Управление глобальными пакетами и папками кэша](../consume-packages/managing-the-global-packages-and-cache-folders.md) , а не `packages` в папке в решении). В результате PackageReference работает быстрее и потребляет меньше места на диске.
* **Тонкое управление зависимостями и потоком содержимого**: Использование существующих функций MSBuild позволяет [условно ссылаться на пакет NuGet](../consume-packages/Package-References-in-Project-Files.md#adding-a-packagereference-condition) и выбирать ссылки на пакеты на целевую платформу, конфигурацию, платформу или другие сводные сведения.
* **PackageReference находится в режиме активной разработки**: См. статью [PackageReference о проблемах на GitHub](https://aka.ms/nuget-pr-improvements). пакет Packages. config больше не находится под активной разработкой.

### <a name="limitations"></a>Ограничения

* PackageReference NuGet недоступен в Visual Studio 2015 и более ранних версиях. Перенесенные проекты можно открывать только в Visual Studio 2017 и более поздних версиях.
* На данный момент не поддерживается миграция для проектов C++ и ASP.NET.
* Некоторые пакеты могут быть не полностью совместимы с PackageReference. Дополнительные сведения см. в разделе [проблемы совместимости пакетов](#package-compatibility-issues).

### <a name="known-issues"></a>Известные проблемы

1. Параметр `Migrate packages.config to PackageReference...` недоступен в контекстном меню, которое открывается по щелчку правой кнопкой мыши 

#### <a name="issue"></a>Проблемы 
 
При первом открытии проект NuGet не удается инициализировать до выполнения операции NuGet. В результате параметр миграции не отображается в контекстном меню, которое открывается по щелчку правой кнопкой мыши `packages.config` или `References`. 

#### <a name="workaround"></a>Обходной путь 

Выполните одно из следующих действий NuGet: 
* Откройте пользовательский интерфейс диспетчера пакетов. Для этого щелкните правой кнопкой мыши `References` и выберите `Manage NuGet Packages...`. 
* Откройте консоль диспетчера пакетов. В `Tools > NuGet Package Manager` выберите `Package Manager Console`. 
* Запустите восстановление NuGet. Для этого щелкните правой кнопкой мыши узел решения в обозревателе решений и выберите `Restore NuGet Packages`. 
* Создайте проект, активизирующий восстановление NuGet. 

Теперь параметр миграции должен отобразиться. Обратите внимание, что этот параметр не поддерживается и не будет отображаться для типов проектов ASP.NET и C++. 

## <a name="migration-steps"></a>Этапы миграции

> [!Note]
> Перед началом миграции Visual Studio создает резервную копию проекта, чтобы можно было [выполнить откат к Packages. config](#how-to-roll-back-to-packagesconfig) при необходимости.

1. Откройте решение, содержащее проект с `packages.config`помощью.

1. В **Обозреватель решений**щелкните правой кнопкой мыши `packages.config` узел **ссылки** или файл и выберите команду **перенести Packages. config в PackageReference...** .

1. Migrator анализирует ссылки на пакет NuGet проекта и пытается классифицировать их в **зависимости верхнего уровня** (пакеты NuGet, установленные напрямую) и **транзитивные зависимости** (пакеты, которые были установлены как зависимости пакетов верхнего уровня).

   > [!Note]
   > PackageReference поддерживает транзитивное восстановление пакетов и разрешает зависимости динамически, что означает, что транзитивные зависимости не должны устанавливаться явным образом.

1. Используемых Пакет NuGet, классифицированный как транзитивное зависимость, можно рассматривать как зависимость верхнего уровня, выбрав параметр **верхнего уровня** для пакета. Этот параметр автоматически устанавливается для пакетов, содержащих ресурсы, которые не передаются транзитным образом ( `build`в `buildCrossTargeting` `contentFiles`папках, `analyzers` , или) и помечены как зависимость разработки (`developmentDependency = "true"`).

1. Проверьте все [проблемы совместимости пакетов](#package-compatibility-issues).

1. Нажмите кнопку **ОК** , чтобы начать миграцию.

1. По завершении миграции Visual Studio предоставляет отчет с путем к резервной копии, списком установленных пакетов (зависимости верхнего уровня), списком пакетов, на которые имеются ссылки в виде транзитивных зависимостей, и списком проблем совместимости, определенных в начале преобразования. Отчет сохраняется в папку резервного копирования.

1. Проверьте, выполняется сборка и запуск решения. Если возникли проблемы, [Задайте проблему на GitHub](https://github.com/NuGet/Home/issues/).

## <a name="how-to-roll-back-to-packagesconfig"></a>Откат к Packages. config

1. Закройте перенесенный проект.

1. Скопируйте файл проекта и `packages.config` из резервной копии (обычно `<solution_root>\MigrationBackup\<unique_guid>\<project_name>\`) в папку проекта. Удалите папку obj, если она существует в корневом каталоге проекта.

1. Откройте проект.

1. Откройте консоль диспетчера пакетов с помощью **инструментов > диспетчер пакетов NuGet > команду меню консоли диспетчера пакетов** .

1. В консоли выполните следующую команду:

   ```ps
   update-package -reinstall
   ```

## <a name="create-a-package-after-migration"></a>Создание пакета после миграции

После завершения миграции рекомендуется добавить ссылку на пакет NuGet [. Build. Tasks. Pack](https://www.nuget.org/packages/nuget.build.tasks.pack) , а затем использовать [MSBuild-т:ПАКК](../reference/msbuild-targets.md#pack-target) для создания пакета. Хотя в некоторых сценариях можно использовать `dotnet.exe pack` `msbuild -t:pack`вместо, не рекомендуется.

## <a name="package-compatibility-issues"></a>Проблемы совместимости пакетов

Некоторые аспекты, поддерживаемые в Packages. config, не поддерживаются в PackageReference. Migrator анализирует и обнаруживает такие проблемы. Любой пакет, в котором есть одна или несколько из следующих проблем, может работать неправильно после миграции.

### <a name="installps1-scripts-are-ignored-when-the-package-is-installed-after-the-migration"></a>При установке пакета после миграции скрипты install. ps1 игнорируются.

| | |
| --- | --- |
| **Описание** | При использовании PackageReference сценарии PowerShell Install. ps1 и Uninstall. ps1 не выполняются при установке или удалении пакета. |
| **Потенциальное воздействие** | Пакеты, зависящие от этих скриптов, для настройки определенного поведения в целевом проекте могут работать не так, как ожидалось. |

### <a name="content-assets-are-not-available-when-the-package-is-installed-after-the-migration"></a>ресурсы "содержимое" недоступны при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | Ресурсы в `content` папке пакета не поддерживаются с PackageReference и игнорируются. PackageReference добавляет поддержку для `contentFiles` , чтобы обеспечить лучшую транзитную поддержку и общее содержимое.  |
| **Потенциальное воздействие** | Активы в `content` не копируются в проект и код проекта, который зависит от наличия этих ресурсов, требует рефакторинга.  |

### <a name="xdt-transforms-are-not-applied-when-the-package-is-installed-after-the-upgrade"></a>Преобразования XDT не применяются при установке пакета после обновления

| | |
| --- | --- |
| **Описание** | Преобразования xdt не поддерживаются в PackageReference, а `.xdt` файлы игнорируются при установке или удалении пакета.   |
| **Потенциальное воздействие** | Преобразования xdt не применяются к XML-файлам проекта, чаще всего — `web.config.install.xdt` и `web.config.uninstall.xdt`, что означает, что` web.config` файл проекта не обновляется при установке или удалении пакета. |

### <a name="assemblies-in-the-lib-root-are-ignored-when-the-package-is-installed-after-the-migration"></a>Сборки в корне lib игнорируются при установке пакета после миграции.

| | |
| --- | --- |
| **Описание** | При использовании PackageReference сборки, которые находятся в корне `lib` папки без вложенной папки для конкретной платформы, игнорируются. NuGet ищет вложенную папку, соответствующую моникеру целевой платформы (TFM), соответствующей целевой платформе проекта, и устанавливает соответствующие сборки в проект. |
| **Потенциальное воздействие** | Пакеты, не имеющие вложенной папки, соответствующей моникеру целевой платформы (TFM), соответствующей целевой платформе проекта, могут работать неправильно после перехода или сбоя установки во время миграции. |

## <a name="found-an-issue-report-it"></a>Обнаружили ошибку? Сообщить!

Если возникла проблема с миграцией, напишите [о проблеме в репозитории NuGet GitHub](https://github.com/NuGet/Home/issues/).
