---
title: Переход с package.config на форматов PackageReference
description: Сведения о том, как миграция проекта из формата управления package.config в PackageReference, который поддерживается в .NET Core 2.0 и Visual Studio 2017 и NuGet 4.0 +
author: karann-msft
ms.author: karann
ms.date: 05/24/2019
ms.topic: conceptual
ms.openlocfilehash: 09d132aeaf00d2a1d095b9638b455cc23de91f2c
ms.sourcegitcommit: b8c63744252a5a37a2843f6bc1d5917496ee40dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66812870"
---
# <a name="migrate-from-packagesconfig-to-packagereference"></a>Перенос из packages.config в PackageReference

Visual Studio 2017 версии 15.7 и более поздние версии поддерживают при переносе проекта из [packages.config](./packages-config.md) формат управления [PackageReference](../consume-packages/Package-References-in-Project-Files.md) формат.

## <a name="benefits-of-using-packagereference"></a>Преимущества использования PackageReference

* **Управление все зависимости проекта в одном месте**: Так же, как ссылки проекта на проект и ссылки на сборки, ссылается на пакет NuGet (с помощью `PackageReference` узла) осуществляется непосредственно в файлах проекта, а не с помощью файла отдельные packages.config.
* **Загромождать представление зависимостей верхнего уровня**: В отличие от packages.config PackageReference перечислены только те пакеты NuGet непосредственно устанавливается в проекте. Таким образом пользовательский Интерфейс диспетчера пакетов NuGet и файл проекта не загроможден зависимости нижнего уровня.
* **Повышение производительности**: При использовании PackageReference, пакеты хранятся в *глобальных пакетов* папку (как описано в разделе [управление папкой установки глобальных пакетов и папками кэша](../consume-packages/managing-the-global-packages-and-cache-folders.md) , а не в `packages` папки в решение. В результате PackageReference выполняется быстрее и занимает меньше места на диске.
* **Детальный контроль над зависимостями и потоком содержимого**: С помощью существующих функций MSBuild позволяет [условно ссылаться на пакет NuGet](../consume-packages/Package-References-in-Project-Files.md#adding-a-packagereference-condition) и выбора ссылок на пакеты на целевой платформы, конфигурации, платформы или других сведений.
* **PackageReference находится в активной разработке**: См. в разделе [PackageReference проблемы на GitHub](https://aka.ms/nuget-pr-improvements). Packages.config больше не находится в активной разработке.

### <a name="limitations"></a>Ограничения

* NuGet PackageReference не доступны в Visual Studio 2015 и более ранних версий. Перенесенные проекты можно открывать только в Visual Studio 2017.
* Миграция в настоящее время не доступна для проектов C++ и ASP.NET.
* Некоторые пакеты не может быть полностью совместимы с PackageReference. Дополнительные сведения см. в разделе [проблемы совместимости пакетов](#package-compatibility-issues).

### <a name="known-issues"></a>Известные проблемы

1. Параметр `Migrate packages.config to PackageReference...` недоступен в контекстном меню, которое открывается по щелчку правой кнопкой мыши 

#### <a name="issue"></a>Проблемы 
 
При первом открытии проект NuGet не удается инициализировать до выполнения операции NuGet. В результате параметр миграции не отображается в контекстном меню, которое открывается по щелчку правой кнопкой мыши `packages.config` или `References`. 

#### <a name="workaround"></a>Обходной путь 

Выполните одно из следующих действий NuGet: 
* Откройте пользовательский интерфейс диспетчера пакетов. Для этого щелкните правой кнопкой мыши `References` и выберите `Manage NuGet Packages...`. 
* Откройте консоль диспетчера пакетов. В `Tools > NuGet Package Manager` выберите `Package Manager Console`. 
* Запустите восстановление NuGet. Для этого щелкните правой кнопкой мыши узел решения в обозревателе решений и выберите `Restore NuGet Packages`. 
* Создайте проект, активизирующий восстановление NuGet. 

Теперь параметр миграции должен отобразиться. Обратите внимание, что этот параметр не поддерживается и не будет отображаться для типов проектов ASP.NET и C++. 

## <a name="migration-steps"></a>Этапы миграции

> [!Note]
> Перед началом миграции, Visual Studio создает копию проекта, чтобы можно было [выполните откат до packages.config](#how-to-roll-back-to-packagesconfig) при необходимости.

1. Откройте решение, содержащее проект с помощью `packages.config`.

1. В **обозревателе решений**, щелкните правой кнопкой мыши **ссылки** узел или `packages.config` файл и выберите **перенос packages.config в PackageReference...** .

1. Migrator анализирует ссылки на пакеты NuGet проекта и предпринимается попытка классифицировать их в **зависимостей верхнего уровня** (пакеты NuGet, установленные непосредственно) и **транзитивные зависимости** (пакеты, установленные как зависимости пакетов верхнего уровня).

   > [!Note]
   > PackageReference поддерживает восстановление транзитивное пакета и разрешает зависимости динамически, это означает, что транзитивные зависимости не требуется установка явным образом.

1. (Необязательно) Вы можете обрабатывать пакет NuGet, которые классифицируются как транзитивной зависимости как зависимость верхнего уровня, выбрав **верхнего уровня** параметр для пакета. Этот параметр автоматически принимает значение пакеты, содержащие ресурсы, которые не передаются транзитивно (в `build`, `buildCrossTargeting`, `contentFiles`, или `analyzers` папки) и те, помеченные как зависимость разработки (`developmentDependency = "true"`).

1. Просмотреть все [проблемы совместимости пакетов](#package-compatibility-issues).

1. Выберите **ОК** начать миграцию.

1. В конце миграции Visual Studio предоставляет отчет с путем к резервной копии, список установленных пакетов (зависимостей верхнего уровня), список пакетов, называемое транзитивные зависимости и список проблем совместимости, описанных в начале Миграция. Отчет сохраняется в папку резервного копирования.

1. Проверьте, что сборка и запуск решения. Если у вас возникли проблемы, [сообщите о проблеме на GitHub](https://github.com/NuGet/Home/issues/).

## <a name="how-to-roll-back-to-packagesconfig"></a>Как откатить для packages.config

1. Закройте переноса проекта.

1. Скопируйте файл проекта и `packages.config` из резервной копии (обычно `<solution_root>\MigrationBackup\<unique_guid>\<project_name>\`) в папку проекта. Удалите папку obj, если он существует в корневом каталоге проекта.

1. Откройте проект.

1. Откройте консоль диспетчера пакетов с помощью **Сервис > Диспетчер пакетов NuGet > консоль диспетчера пакетов** команды меню.

1. Выполните следующую команду в консоли:

   ```ps
   update-package -reinstall
   ```

## <a name="create-a-package-after-migration"></a>Создание пакета после миграции

По завершении миграции рекомендуется добавлять ссылку на [nuget.build.tasks.pack](https://www.nuget.org/packages/nuget.build.tasks.pack) nuget пакета, а затем используйте [пакета msbuild](../reference/msbuild-targets.md#pack-target) для создания пакета. Несмотря на то, что в некоторых случаях можно было использовать `dotnet.exe pack` вместо `msbuild pack`, не рекомендуется.

## <a name="package-compatibility-issues"></a>Проблемы совместимости пакетов

Неподдерживаемые некоторые аспекты, которые поддерживались в файл packages.config в PackageReference. Migrator анализирует и обнаруживает такие проблемы. Любой пакет, который имеет один или несколько из следующих проблем могут работать не так, как ожидалось, после миграции.

### <a name="installps1-scripts-are-ignored-when-the-package-is-installed-after-the-migration"></a>сценарии «install.ps1» игнорируются при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | С помощью PackageReference install.ps1 и uninstall.ps1 скрипты PowerShell не выполняются во время установки или удаления пакета. |
| **Потенциальное влияние** | Пакеты, которые зависят эти сценарии, чтобы настроить определенное поведение в целевом проекте может не работать должным образом. |

### <a name="content-assets-are-not-available-when-the-package-is-installed-after-the-migration"></a>активы «content» недоступны, при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | Ресурсы-контейнеры в пакете `content` папку с PackageReference не поддерживаются и игнорируются. PackageReference добавлена поддержка `contentFiles` лучше транзитивное поддержки и общего содержимого.  |
| **Потенциальное влияние** | Ресурсы-контейнеры в `content` не копируются в проект и проект код, который зависит от наличия этих средств требуется рефакторинг.  |

### <a name="xdt-transforms-are-not-applied-when-the-package-is-installed-after-the-upgrade"></a>При установке пакета после обновления не применяются преобразования XDT

| | |
| --- | --- |
| **Описание** | Преобразования XDT не поддерживаются с помощью PackageReference и `.xdt` файлы игнорируются при установке или удалении пакета.   |
| **Потенциальное влияние** | Преобразования XDT не применяются к XML-файлы в любой проект, чаще всего `web.config.install.xdt` и `web.config.uninstall.xdt`, означающее проекта` web.config` файл не обновляется при установке или удалении пакета. |

### <a name="assemblies-in-the-lib-root-are-ignored-when-the-package-is-installed-after-the-migration"></a>Сборки в корневом каталоге lib, игнорируются при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | Используя PackageReference, сборок, представить в корне `lib` папку без target framework специальной вложенной папке игнорируются. NuGet ищет во вложенную папку сопоставления моникер целевой платформы (TFM), соответствующий целевой платформы проекта и устанавливает соответствующие сборки в проект. |
| **Потенциальное влияние** | Пакеты, у которых нет во вложенную папку сопоставления моникер целевой платформы (TFM), соответствующий целевой платформы проекта, могут не работают корректно после перехода или не установки во время миграции |

## <a name="found-an-issue-report-it"></a>Столкнулись с проблемой? Сообщите об этом!

Если возникли проблемы с процесс миграции, [сообщите о проблеме в репозитории NuGet GitHub](https://github.com/NuGet/Home/issues/).
